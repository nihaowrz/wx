import tkinter as tk
from threading import Thread
import time
import pyautogui
import keyboard
import pyperclip
import pygetwindow as gw

class AutoScriptApp:
    def __init__(self, root):
        self.root = root
        self.root.title("自动脚本")
        
        self.is_running = False
        self.phone_numbers = ["173767687", "18600441683", "18000905386"]
        self.status_labels = []
        
        self.start_button = tk.Button(root, text="开始", command=self.start_script)
        self.start_button.pack(pady=10)
        
        self.info_label = tk.Label(root, text="按下 F1 键退出程序")
        self.info_label.pack(pady=10)
        
        self.input_entry = tk.Entry(root)
        self.input_entry.pack(pady=10)
        
        self.confirm_button = tk.Button(root, text="确认", command=self.confirm_input)
        self.confirm_button.pack(pady=5)
        
        self.status_bar = tk.Label(root, text="", bd=1, relief=tk.SUNKEN, anchor=tk.W)
        self.status_bar.pack(side=tk.BOTTOM, fill=tk.X)
        
        self.f1_thread = None
    
    def start_script(self):
        if not self.is_running:
            self.is_running = True
            self.start_button.config(state="disabled")
            self.f1_thread = Thread(target=self.check_for_f1)
            self.script_thread = Thread(target=self.run_script)
            self.script_thread.start()
            self.f1_thread.start()
    
    def check_for_f1(self):
        while self.is_running:
            if keyboard.is_pressed('F1'):
                self.is_running = False
                self.f1_thread.join()
                break
    
    def run_script(self):
        for idx, phone_number in enumerate(self.phone_numbers):
            if not self.is_running:
                break
            self.update_status(idx, "运行中")
            self.execute_script(phone_number, idx)
            self.update_status(idx, "完成")
            print("电话号码 {} 执行完毕".format(phone_number))
        self.start_button.config(state="normal")
    
    def execute_script(self, phone_number, idx):
        state = 0

        time.sleep(3)
        
        click_x, click_y = 535, 260
        pyautogui.click(click_x, click_y)
        print("已自动点击坐标位置：({}, {})".format(click_x, click_y))
        
        # 省略后续操作...

        self.update_status(idx, "结束")
    
    def confirm_input(self):
        user_input = self.input_entry.get()
        pyperclip.copy(user_input)
        print("已复制文本内容到粘贴板：{}".format(user_input))
    
    def update_status(self, idx, new_status):
        self.status_labels[idx].config(text=new_status)
        self.root.update_idletasks()

if __name__ == "__main__":
    root = tk.Tk()
    app = AutoScriptApp(root)
    
    for phone_number in app.phone_numbers:
        status_label = tk.Label(root, text="", anchor=tk.W)
        status_label.pack(fill=tk.X, padx=10, pady=2)
        app.status_labels.append(status_label)
    
    root.mainloop()
